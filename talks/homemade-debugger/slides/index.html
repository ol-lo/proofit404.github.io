<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="css/reveal.css"><link rel="stylesheet" type="text/css" href="css/theme/white.css" id="theme"><link rel="stylesheet" type="text/css" href="css/customize.css"><title>Homemade debugger</title><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section><h2>Homemade debugger</h2><h3>Artem Malyshev</h3><h4>@proofit404</h4></section><section><h2>Proud member of the</h2><h2>Django Channels</h2><h2>maintenance team</h2></section><section><h2>Jimmy's story</h2></section><section><h3>Wow, Python is so cool!</h3><h3>I will write my next project in Python!</h3><img class="comics" src="pic/pc.png"></section><section><h3>Lol, you are using print statements for debugging?!</h3><img class="comics" src="pic/wtf.png"></section><section><h3>if only I can write debugger myself...</h3><img class="comics" src="pic/fantasy.png"></section><section><h2>Chapter 1</h2><h4>Inside a Python interpreter</h4></section><section><h3>Source code</h3><pre><code><b>def</b> foo(a, b):
    <b>return</b> a + b

<b>if</b> __name__ == '__main__':
    <b>print</b>(foo(1, 2))</code></pre></section><section><h3>Bytecode</h3><pre><code><b>$ python -m dis simple.py</b>
   0 LOAD_CONST        (&lt;code object foo&gt;)
  ...
  16 LOAD_NAME         (print)
  18 LOAD_NAME         (foo)
  20 LOAD_CONST        (1)
  22 LOAD_CONST        (2)
  24 CALL_FUNCTION
  26 CALL_FUNCTION</code></pre></section><section><h3>Frame evaluation</h3><pre><code>_PyEval_EvalFrameDefault(<b>PyFrameObject</b> *f, <b>int</b> throwflag) {
     <b>switch</b> (opcode) {
          TARGET(CALL_FUNCTION) {
               <b>PyObject</b> **sp, *res;
               res = call_function(&sp, oparg, NULL);
               stack_pointer = sp;
               PUSH(res);
          }
     }
}</code></pre></section><section><h3>Python 1.4 Changelog</h3><img class="comics" src="pic/changelog.png"></section><section><h3>Trace function</h3><pre><code class="gray">_PyEval_EvalFrameDefault(<b>PyFrameObject</b> *f, <b>int</b> throwflag) {
     <b>switch</b> (opcode) {
          TARGET(CALL_FUNCTION) {
               <b>PyObject</b> **sp, *res;
               res = call_function(&sp, oparg, NULL);
               <mark class="black">call_trace(tracefunc, frame);</mark>
               <mark class="black">JUMPTO(frame->f_lasti);</mark>
               PUSH(res);
          }
}</code></pre></section><section><h2>Chapter 2</h2><h4>Pdb implementation</h4></section><section><h3>Settrace event table</h3><table><tr><td>'call'</td><td>Before a function is executed.</td></tr><tr><td>'line'</td><td>Before a line is executed.</td></tr><tr><td>'return'</td><td>Before a function returns.</td></tr><tr><td>'exception'</td><td>After an exception occurs.</td></tr></table></section><section><h3>Setup debugger</h3><pre><code class="gray"><b>def</b> foo(a, b):
    <b>return</b> a + b

<b>if</b> __name__ == '__main__':
    <mark class="black"><b>import</b> mydbg.set_trace()</mark>
    <b>print</b>(foo(1, 2))</code></pre></section><section><h3>Naive usage</h3><pre><code><b>import</b> sys                                   <b>$ python simple.py</b>
                                                   call
<b>def</b> set_trace():                           ['f_back', 'f_code', 'f_locals']
    sys.settrace(dispatch)

<b>def</b> dispatch(frame, event, arg):
    <b>print</b>(event)
    <b>print</b>(<b>dir</b>(frame))</code></pre></section><section><h3>Nested calls</h3><pre><code class="gray"><b>import</b> sys                                   <mark class="black"><b>$ python simple.py</b></mark>
                                                   <mark class="black">call</mark>
<b>def</b> set_trace():                           <mark class="black">['f_back', 'f_code', 'f_locals'</mark>]
    sys.settrace(dispatch)                <mark class="black">line</mark>
                                                   <mark class="black">['f_back', 'f_code', 'f_locals'</mark>]
<b>def</b> dispatch(frame, event, arg):
    <b>print</b>(event)
    <b>print</b>(<b>dir</b>(frame))
    <mark class="black"><b>return</b> dispatch</mark></code></pre></section><section><h3>Print code lines</h3><pre><code class="gray"><b>import</b> sys                                       <mark class="black"><b>$ python simple.py</b></mark>
<mark class="black"><b>import</b> linecache</mark>                               <mark class="black"><b>def</b> foo(a, b):</mark>
                                                       <mark class="black"><b>return</b> a + b</mark>
<b>def</b> dispatch(frame, event, arg):        <mark class="black"><b>return</b> a + b</mark>
    <mark class="black">line = linecache.getline(</mark>
        <mark class="black">frame.f_code.co_filename,</mark>
        <mark class="black">frame.f_lineno,</mark>
    <mark class="black">)</mark>
    <mark class="black"><b>print</b>(line)</mark>
    <b>return</b> dispatch</code></pre></section><section><h2>Chapter 3</h2><h4>Threads and Multiprocessing</h4></section><section><h2>Chapter 4</h2><h4>Coroutines and asyncio</h4></section><section><h2>Chapter 5</h2><h4>Smart Tracing</h4></section><section><h3>What if you even don't know where to start</h3><img class="comics" src="pic/reviewing.png"></section><section><h2>Chapter 6</h2><h4>Many years after...</h4></section><section><h3>A lot of cool tools were developed</h3><img class="comics" src="pic/antigravity.png"></section><section><h4>ipdb, pdb++, winpdb</h4><h4>BeeWare bugjar</h4><h4>JetBrains PyCharm debugger</h4><h4>GDB python extensions</h4></section><section><h2>The End</h2></section></div></div><script src="lib/js/head.min.js"></script><script src="js/reveal.js"></script><script>Reveal.initialize({
    controls: false,
    progress: false,
    slideNumber: true,
    history: true,
    transition: 'none',
    dependencies: [
        { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } }
    ]
});</script></body></html>