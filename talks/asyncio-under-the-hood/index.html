<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/beige.css">
    <link rel="stylesheet" href="lib/css/default.css">
    <link rel="stylesheet" href="css/customize.css">
    <title>asyncio under the hood</title>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>asyncio under the hood</h1>
          <h3>@proofit404</h3>
        </section>
        <section>
          <h1>О чём вообще речь?</h1>
        </section>
        <section>
          <h2>Synchronous code</h2>
          <pre>
            <code class="hljs">
while True:
    if click_happens():
        process_click()
    else:
        time.sleep(0.05)
              </code>
          </pre>
        </section>
        <section>
          <h2>Asynchronous code</h2>
          <pre>
            <code class="hljs">
&lt;button onclick="alert('Hello');"&gt;
    Push it!
&lt;/button&gt;
            </code>
          </pre>
        </section>
        <section>
          <h2>Redis handler</h2>
          <pre>
            <code class="hljs">
def apply(redis, num):
    key = b'foo' + num
    redis.execute_command('set', key, num)
    result = redis.execute_command('get', key)
    assert result == num
            </code>
          </pre>
        </section>
        <section>
          <h2>Run test</h2>
          <pre>
            <code class="hljs">
def do():
    redis = StrictRedis()
    start = time()
    for x in range(10000):
        apply(redis, str(x).encode())
    end = time()
    print('Time spent:', end - start)
            </code>
          </pre>
        </section>
        <section>
          <h2>aioredis handler</h2>
          <pre>
            <code class="hljs">
@asyncio.coroutine
def apply(redis, num):
    key = b'foo' + num
    yield from redis.execute(b'set', key, num)
    result = yield from redis.execute(b'get', key)
    assert result == num
            </code>
          </pre>
        </section>
        <section>
          <h2>Run asynchronous test</h2>
          <section>
            <pre>
              <code class="hljs">
@asyncio.coroutine
def do(loop):
    redis = yield from create_connection(('localhost', 6379), loop=loop)
    start = loop.time()
    tasks = [asyncio.ensure_future(apply(redis, str(x).encode()))
             for x in range(10000)]
    yield from asyncio.wait(tasks)
    end = loop.time()
    print('Time spent:', end - start)
    redis.close()
    yield from redis.wait_closed()
              </code>
            </pre>
          </section>
        </section>
        <section>
          <h2>Results so far</h2>
          <pre>
            <code class="hljs">
$ python synctest.py
Time spent: 10.756768226623535
$ python asynctest.py
Time spent: 11.661769957999695
            </code>
          </pre>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'slide',
        dependencies: [
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
    </script>
  </body>
</html>
